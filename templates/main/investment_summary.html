{% extends 'main/base.html' %}

{% block title %}Investment Summary{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto py-10 px-4">
  <div class="mb-12">
    <h1 class="text-4xl font-black mb-2">Investment Summary</h1>
    <p class="text-gray-500 font-bold uppercase tracking-widest text-xs">A comprehensive view of your portfolio
      performance</p>
  </div>

  <!-- Summary Statistics Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
    <!-- Total Invested -->
    <div class="glass p-8 rounded-[40px] card-shadow border-white/5">
      <p class="text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] mb-4">Total Invested</p>
      <h2 class="text-3xl font-black">₹{{ total_invested|floatformat:2 }}</h2>
    </div>

    <!-- Current Value -->
    <div class="glass p-8 rounded-[40px] card-shadow border-white/5">
      <p class="text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] mb-4">Current Value</p>
      <h2 class="text-3xl font-black text-groww">₹{{ current_value|floatformat:2 }}</h2>
    </div>

    <!-- Total Returns -->
    <div class="glass p-8 rounded-[40px] card-shadow border-white/5">
      <p class="text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] mb-4">Total Returns</p>
      <div class="flex items-center space-x-2">
        <span class="text-3xl font-black {% if profit_loss >= 0 %}text-groww{% else %}text-red-500{% endif %}">
          {% if profit_loss >= 0 %}+{% endif %}₹{{ profit_loss|floatformat:2|cut:"-" }}
        </span>
      </div>
    </div>

    <!-- Percentage Return -->
    <div class="glass p-8 rounded-[40px] card-shadow border-white/5">
      <p class="text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] mb-4">Returns (%)</p>
      <div class="flex items-center space-x-2">
        <span class="text-3xl font-black {% if profit_loss >= 0 %}text-green-400{% else %}text-red-400{% endif %}">
          {% if profit_loss >= 0 %}+{% endif %}{{ pnl_percent|floatformat:2 }}%
        </span>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Performance Chart -->
    <div class="lg:col-span-2 glass p-10 rounded-[50px] card-shadow">
      <div class="flex justify-between items-center mb-8">
        <h3 class="text-xl font-black uppercase tracking-widest">Growth Analysis</h3>
        <div class="flex space-x-2">
          <span class="text-[10px] font-black bg-groww/10 text-groww px-3 py-1 rounded-full border border-groww/20">LIVE
            DATA</span>
        </div>
      </div>
      <canvas id="investmentChart" style="max-height: 350px;"></canvas>
    </div>

    <!-- Recent Holdings Activity -->
    <div class="glass p-10 rounded-[50px] card-shadow">
      <h3 class="text-xl font-black mb-8 border-b border-white/5 pb-4 uppercase tracking-widest">Holdings Details</h3>
      <div class="space-y-6">
        {% if holdings %}
        {% for item in holdings %}
        <div class="flex justify-between items-center group">
          <div>
            <p class="text-sm font-black group-hover:text-groww transition">{{ item.stock.symbol }}</p>
            <p class="text-[10px] font-bold text-gray-500 uppercase tracking-widest">{{ item.quantity }} Shares</p>
          </div>
          <div class="text-right">
            <p class="text-sm font-black italic">Avg: ₹{{ item.avg_price }}</p>
          </div>
        </div>
        {% endfor %}
        {% else %}
        <p class="text-gray-500 text-sm italic py-10 text-center">No active holdings in your portfolio.</p>
        {% endif %}
      </div>

      <div class="mt-10 pt-6 border-t border-white/5">
        <a href="{% url 'dashboard' %}"
          class="w-full bg-groww/10 text-groww py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest hover:bg-groww/20 transition flex items-center justify-center border border-groww/20">
          Trade More Stocks <i class="fas fa-arrow-right ml-2"></i>
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Chart Data Ingestion -->
<script id="chart-labels" type="application/json">{{ chart_labels|safe }}</script>
<script id="chart-data" type="application/json">{{ chart_data|safe }}</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const labels = JSON.parse(document.getElementById('chart-labels').textContent);
    const data = JSON.parse(document.getElementById('chart-data').textContent);

    const ctx = document.getElementById('investmentChart').getContext('2d');
    const gradient = ctx.createLinearGradient(0, 0, 0, 400);
    gradient.addColorStop(0, 'rgba(0, 208, 156, 0.2)');
    gradient.addColorStop(1, 'rgba(0, 208, 156, 0)');

    new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Portfolio Value',
          data: data,
          borderColor: '#00d09c',
          borderWidth: 4,
          pointBackgroundColor: '#00d09c',
          pointBorderColor: '#0f1115',
          pointBorderWidth: 2,
          pointRadius: 6,
          pointHoverRadius: 8,
          tension: 0.4,
          fill: true,
          backgroundColor: gradient
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          tooltip: {
            backgroundColor: '#1a1c1e',
            titleFont: { size: 12, weight: 'bold' },
            bodyFont: { size: 14, weight: 'black' },
            padding: 12,
            borderColor: 'rgba(255,255,255,0.1)',
            borderWidth: 1,
            displayColors: false,
            callbacks: {
              label: function (context) {
                return '₹' + context.parsed.y.toLocaleString();
              }
            }
          }
        },
        scales: {
          y: {
            grid: { display: false, drawBorder: false },
            ticks: { color: 'rgba(255,255,255,0.3)', font: { size: 10, weight: 'bold' } }
          },
          x: {
            grid: { display: false, drawBorder: false },
            ticks: { color: 'rgba(255,255,255,0.3)', font: { size: 10, weight: 'bold' } }
          }
        }
      }
    });
  });
</script>
{% endblock %}